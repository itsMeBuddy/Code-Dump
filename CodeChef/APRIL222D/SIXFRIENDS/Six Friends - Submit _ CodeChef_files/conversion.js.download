!function(i,e,t,s){t.modules({"webengage/conversion":[function(i,e,s){"use strict";var a,f=t.require("webengage/util"),d=t.require("webengage/dom"),v=t.require("webengage/events"),c=t.require("webengage/rules"),r=t.require("webengage/state"),w=t.require("webengage/weq");a=location.host.match(/^(([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])\.){3}([0-9]|[1-9][0-9]|1[0-9]{2}|2[0-4][0-9]|25[0-5])$/)?location.host:-1===location.host.indexOf(".")?location.host.split(":")[0]:location.host.split(":")[0].match(/[-\w]+(\.(?:[-\w]+\.xn--[-\w]+|[-\w]{3,}|[-\w]+\.[-\w]{2}))?$/i)[0];var l=null,h={setGoalsCookie:function(i){return i=i||{},d.cookie.setCookie("_we_wk_gls_ss_",f.compress.compressToBase64(f.stringify(i)),"","/",a,""),i},getGoalsCookie:function(){var i=f.getCookie("_we_wk_gls_ss_",!0)||null;return i&&("{"!==i.charAt(0)&&(i=f.compress.decompressFromBase64(i)),i=f.parseJSON(i)),i},findNonHashedIds:function(i,e){var s=[];if(i&&i[e]&&f.isArray(i[e]))for(var n=0;n<i[e].length;n++)i[e][n]&&i[e][n].indexOf("#")<0&&(s.push(i[e][n]),i[e][n]+="#");return s},getActiveIds:function(i,e){var s=[],n=r.getServerTimestamp()||null;if(i)for(var t=0;t<i.length;t++){var o=i[t].startTimestamp,a=i[t].endTimestamp;n&&(a&&a<n||o&&n<o)||s.push(i[t][e])}return s},getAllActiveNotifications:function(){return h.getActiveIds(l.notificationRuleList,"notificationEncId")},getAllActiveSurveys:function(){return h.getActiveIds(l.surveyRuleList,"surveyEncId")},idsToRetain:function(i,e){var s=[],n=e?e.join():"";if(i&&n){for(var t=0;t<i.length;t++)0<=n.indexOf(i[t])&&s.push(i[t]);return s}},logConversion:function(i,e){if(i){var s=h.getGoalsCookie(),n={};if(s&&s[i]){var t=h.getAllActiveNotifications(),o=h.getAllActiveSurveys();if(0<t.length){var a=h.idsToRetain(f.isArray(s[i].snids)&&0<s[i].snids.length?s[i].snids:null,t),d=h.idsToRetain(f.isArray(s[i].cnids)&&0<s[i].cnids.length?s[i].cnids:null,t),c=h.idsToRetain(f.isArray(s[i].canids)&&0<s[i].canids.length?s[i].canids:null,t),r=h.idsToRetain(h.findNonHashedIds(s[i],"anids"),t);a&&0<a.length&&(n.snids=a),c&&0<c.length&&(n.ncnids=c),d&&0<d.length&&(n.cnids=d),r&&0<r.length&&(n.anids=r)}if(0<o.length){var l=h.idsToRetain(f.isArray(s[i].ssids)&&0<s[i].ssids.length?s[i].ssids:null,o),g=h.idsToRetain(f.isArray(s[i].tsids)&&0<s[i].tsids.length?s[i].tsids:null,o),u=h.idsToRetain(h.findNonHashedIds(s[i],"asids"),o);l&&0<l.length&&(n.ssids=l),g&&0<g.length&&(n.tsids=g),u&&0<u.length&&(n.asids=u)}}f.isEmptyObject(w.get("webengage.customData"))||f.copy(n,w.get("webengage.customData")||{}),f.isEmptyObject(w.get("webengage.notification.customData"))||f.copy(n,w.get("webengage.notification.customData")||{}),f.isEmptyObject(w.get("webengage.survey.customData"))||f.copy(n,w.get("webengage.survey.customData")||{}),f.isEmptyObject(e)||f.copy(n,e,!0),v.publish("event.system","goal_accomplish",n,{goal_id:i}),s&&s[i]&&(delete s[i].snids,delete s[i].cnids,delete s[i].canids,delete s[i].ssids,delete s[i].tsids,h.setGoalsCookie(s))}}};function g(o){var a=o.id;function n(i,e){var s=e.notificationId||e.id;if(s&&0<=o.nIds.join().indexOf(s)){var n=h.getGoalsCookie()||{};switch(n[a]=n[a]||{},i){case"open":e.isNotificationClickable?(n[a].canids=n[a].canids||[],n[a].canids.join().indexOf(e.notificationId)<0&&n[a].canids.push(e.notificationId)):(n[a].snids=n[a].snids||[],n[a].snids.join().indexOf(e.notificationId)<0&&n[a].snids.push(e.notificationId)),h.setGoalsCookie(n);break;case"click":n[a].cnids=n[a].cnids||[],n[a].cnids.join().indexOf(e.notificationId)<0&&n[a].cnids.push(e.notificationId),h.setGoalsCookie(n);break;case"view":case"abs_view":var t="view"===i?"intc":"aintc";n[a][t]||(n[a][t]=1),"abs_view"===i&&(n[a].anids=n[a].anids||[],f.indexOfArray(n[a].anids,s)<0&&f.indexOfArray(n[a].anids,s+"#")<0&&n[a].anids.push(s)),h.setGoalsCookie(n)}}}t.notification.onOpen(function(i){n("open",i)}),t.notification.onClick(function(i){n("click",i)}),v.subscribe("event.system",function(i,e,s){"notification_view"===i?n("view",{notificationId:s.id}):"notification_abs_view"===i&&n("abs_view",{notificationId:s.id})})}function u(o){var a=o.id;function n(i,e){var s=e.surveyId||e.id;if(s&&0<=o.sIds.join().indexOf(s)){var n=h.getGoalsCookie()||{};switch(n[a]=n[a]||{},i){case"open":n[a].ssids=n[a].ssids||[],n[a].ssids.join().indexOf(s)<0&&n[a].ssids.push(s),h.setGoalsCookie(n);break;case"submit":case"complete":n[a].tsids=n[a].tsids||[],n[a].tsids.join().indexOf(s)<0&&n[a].tsids.push(s),h.setGoalsCookie(n),o.type&&"SURVEY_COMPLETION"===o.type&&"complete"===i&&h.logConversion(a);break;case"view":case"abs_view":var t="view"===i?"intc":"aintc";n[a][t]||(n[a][t]=1),"abs_view"===i&&(n[a].asids=n[a].asids||[],f.indexOfArray(n[a].asids,s)<0&&f.indexOfArray(n[a].asids,s+"#")<0&&n[a].asids.push(s)),h.setGoalsCookie(n)}}}t.survey.onOpen(function(i){n("open",i)}),t.survey.onSubmit(function(i){n("submit",i)}),t.survey.onComplete(function(i){n("complete",i)}),v.subscribe("event.system",function(i,e,s){"survey_view"===i?n("view",{surveyId:s.id}):"survey_abs_view"===i&&n("abs_view",{surveyId:s.id})})}var n={push:function(i,e){if(i&&l&&l.goals&&l.goals.length)for(var s,n=0;n<l.goals.length;n++)(s=l.goals[n]).id&&s.id===i&&h.logConversion(i,e)},init:function(i){i&&f.isArray(i.goals)&&0<i.goals.length&&(l=i,v.subscribe("event.system",function(i){"visitor_new_session"===i&&d.cookie.setCookie("_we_wk_gls_ss_","",-1,"/",a,"")}),t.onReady(function(){var i=r.getSession();i.tld&&(a=i.tld),1===i.pvc&&d.cookie.setCookie("_we_wk_gls_ss_","",-1,"/",a,"");for(var e=0;e<l.goals.length;e++){var s=l.goals[e],n=s.value,t=s.type;if(!t||"WEB_RULE"===t){var o=w.get("webengage.ruleData")||w.get("webengage.goals.ruleData")||{};c.execute("",n,o)&&h.logConversion(s.id)}f.isArray(s.nIds)&&0<s.nIds.length&&g(s),f.isArray(s.sIds)&&0<s.sIds.length&&u(s)}}))}};e.exports=n},{}]},{},[])}(window,document,webengage);